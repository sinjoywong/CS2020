# 网络

## 如何理解网络“协议”

所谓的协议，实际上就是一种通信的规约：

## 为什么网络要分为七层/五层模型？

所有的分层都是为了解耦合。对于每一层的上下层中，可以对上对下层有相同的接口（即对外表现相同），而对内部拥有不同的实现细节。
由于计算机系统的复杂性，需要考虑对于网络的实现更是如此。
首先需要考虑的是，多个计算机之间如何进行通信？
我们知道对于单机系统，两个进程间通信可以通过一些内部手段来完成，如共享内存区、管道（通过指向同一个文件描述符）等。这看起来是很简单的，毕竟是同一个内存、cpu，所需考虑的只是进程通信相关的即可。
而对于多台计算机则复杂得多，除了上面要考虑的进程间通信（此时已经是两台计算机之间的进程间通信，不能再共享内存区）以外，还需要考虑多台计算机之间的在物理角度是怎样连接的、基于这物理连接，通信双方是如何建立通信规约的，

因此，网络被划分为如下几个层级，从底层到上层：

## 应用层：

最上层，是应用程序直接处理的一层.常用：socket、用户态到内核态、I/O多路复用。
HTTP数据：原生的数据包。应用层直接给定。HTTP是无状态的，即不保存之前的处理记录，因此即使是针对一些有关联的请求，也需要分别发送接收，效率低。所以才有了cookie技术用于记录状态。

## HTTP

### 早期的每次通信都需TCP连接

### 持久连接（HTTP/1.1)

### 基于持久连接的优化：管线化(pipelining)

类似于TCP连接时的滑动窗口，或是异步操作。无需等待上次的请求响应返回，即可发送下一个请求。但需要考虑一下策略：如何控制并发

### 使用cookies进行状态管理

无状态协议的优势在于节省服务器的CPU和内存资源的消耗。但对于一些业务场景来说是不太好的。由于服务器无法记忆客户端的状态，所以增加了许多不必要的通信。
解决方法是在请求和响应报文中写入cookie信息来控制客户端的状态。服务端在收到携带cookie的信息时，会将cookie写入服务端本地，这样就可以在下次过来请求的时候通过本地cookie和发送过来的cookie比较知道这是之前过来的哪个客户端。

### 断电续传

通过给定一个range来分批次传输。


### DNS：域名解析。

网址与IP的对应关系的解析。人类擅长记忆网址字符串，计算机擅长直接处理数字，因此发明了一种转换关系。保存在DNS服务器中。

## 传输层：

对上层应用层通过处于网络连接中的两台计算机之间的数据传输。有两种不同的协议：TCP和UDP。
TCP: 报文分割、ack号、端口号（用于指定通信进程）

## 网络层：

用于处理网络上流动的数据包，是网络传输的最小单位。该层规定了通过怎样的路径（传输路线）来到达对方计算机，并把数据包传送给对方。
即IP协议。在传输层准备好的包的前提下加入MAC地址，用于找到网卡地址。使用ARP协议通过MAC地址进行通信。
ARP：地址解析协议，通过IP地址反查出MAC地址。
在网络中，没有人能精确地知道传输状况，只能粗略地知道传输路线，只能通过一些广播（ARP）来获得回应的方式，找到下次要转发到哪个节点，这被称为路由。

数据链路层（网络接口层）：处理网络连接的硬件部分。主要处理对象为网卡的硬件的设备驱动，光纤设备/网线设备的一些规约。所有硬件相关的都在数据链路层内范围内。

## 网关

通过网关可以由HTTP请求转换为其他协议通信。